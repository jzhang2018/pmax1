---
- name: Create Storage Group
  hosts: create_storagegroup
  connection: local
  gather_facts: false
  # become: true
  # become_method: sudo

  pre_tasks:
    - name: Display contens
      ansible.builtin.find:
        paths: "/usr/lib/python3.9/site-packages/ansible"
        recurse: yes
      ignore_errors: true
      register: ansible_python_module
    
    - name: Print out ansible python module location
      ansible.builtin.debug:
        msg: "{{ ansible_python_module }}"

    - name: Read ansible.cfg
      ansible.builtin.debug: var=item
      with_file:
        - "/etc/ansible/ansible.cfg"
      ignore_errors: true

    - name: Check whether a package called PyU4U is installed
      ansible.builtin.command: 'pip3 show PyU4V'
      # ansible.builtin.command: 'pip3 list --user | grep PyU4V'
      # ansible.builtin.shell: 'pip3 list --user | grep PyU4V'
      ignore_errors: true
      changed_when: result.rc != 0 # <- Uses the return code to define when the task has changed.
      register: result

    - name: Print out package installation status
      ansible.builtin.debug:
        msg: "{{ result }}"

  roles:
    - create_storagegroup
